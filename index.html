<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebase Record Logger</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #faf6f0;
    color: #333;
    text-align: center;
    margin: 20px;
  }

  /* Password screen */
  .modal {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.45);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .password-box {
    background: white;
    padding: 24px;
    border-radius: 10px;
    width: 300px;
    box-shadow: 0 0 14px rgba(0,0,0,0.25);
  }

  input, select {
    padding: 6px;
    margin: 5px;
    width: 180px;
  }
  button {
    margin: 8px;
    padding: 8px 16px;
    cursor: pointer;
    border: none;
    background: #3b5998;
    color: white;
    border-radius: 6px;
    transition: background 0.2s;
  }
  button:hover {
    background: #2d4373;
  }

  table {
    border-collapse: collapse;
    margin: 20px auto;
    width: 90%;
    background: white;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
  }
  th {
    background: #e3e3e3;
  }

  .status-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: inline-block;
    position: relative;
    margin: 0 auto;
  }
  .status-circle.tick { background-color: #28a745; }
  .status-circle.tick::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    width: 6px; height: 14px;
    border: solid white; border-width: 0 4px 4px 0;
    transform: translate(-50%, -60%) rotate(45deg);
  }
  .status-circle.cross { background-color: #dc3545; }
  .status-circle.cross::before,
  .status-circle.cross::after {
    content: ''; position: absolute;
    left: 50%; top: 50%;
    width: 18px; height: 4px; background-color: white;
  }
  .status-circle.cross::before { transform: translate(-50%, -50%) rotate(45deg); }
  .status-circle.cross::after { transform: translate(-50%, -50%) rotate(-45deg); }
</style>
</head>

<body>

  <!-- Password Modals -->
  <div class="modal" id="setupModal" style="display:none;">
    <div class="password-box">
      <h3>Create Password</h3>
      <input type="password" id="setupPass" placeholder="New Password"><br>
      <button onclick="setPassword()">Save</button>
    </div>
  </div>

  <div class="modal" id="loginModal" style="display:none;">
    <div class="password-box">
      <h3>Enter Password</h3>
      <input type="password" id="loginPass" placeholder="Password"><br>
      <button onclick="checkLogin()">Enter</button>
    </div>
  </div>

  <!-- App Content -->
  <div id="appContent" style="display:none;">
    <h2>Firebase Record Logger</h2>

    <!-- Record Inputs -->
    <input type="text" id="username" placeholder="Username">
    <input type="text" id="status" placeholder="Status (1=tick, else=cross)">
    <input type="text" id="elapsed" placeholder="Elapsed Time">
    <input type="text" id="data" placeholder="Data"><br>
    <button onclick="addRecord()">Add Record</button><br><br>

    <!-- Calendar selection -->
    <label for="datePicker">Select date to view logs:</label>
    <input type="date" id="datePicker">
    <button onclick="viewRecords()">View Records</button>

    <!-- Table -->
    <table>
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>Username</th>
          <th>Status</th>
          <th>Elapsed Time</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody id="recordTableBody">
        <tr><td colspan="5">Click "View Records" to load data.</td></tr>
      </tbody>
    </table>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, get, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAjBbnm8F76BCb9C5fluUyoZ2QnMSXlHOo",
    authDomain: "test-c7bf3.firebaseapp.com",
    databaseURL: "https://test-c7bf3-default-rtdb.firebaseio.com",
    projectId: "test-c7bf3",
    storageBucket: "test-c7bf3.firebasestorage.app",
    messagingSenderId: "573697013702",
    appId: "1:573697013702:web:fe132fc4d796c06bdbe4c7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const appContent = document.getElementById("appContent");
  const setupModal = document.getElementById("setupModal");
  const loginModal = document.getElementById("loginModal");

  async function init() {
    const snap = await get(ref(db, "auth/password"));
    if (snap.exists()) loginModal.style.display = "flex";
    else setupModal.style.display = "flex";
  }
  init();

  // Password setup/login
  window.setPassword = async function() {
    const pass = document.getElementById("setupPass").value.trim();
    if (!pass) return alert("Enter password");
    await set(ref(db, "auth/password"), pass);
    setupModal.style.display = "none";
    appContent.style.display = "block";
  }

  window.checkLogin = async function() {
    const entered = document.getElementById("loginPass").value.trim();
    const snap = await get(ref(db, "auth/password"));
    if (entered === snap.val()) {
      loginModal.style.display = "none";
      appContent.style.display = "block";
    } else {
      alert("Incorrect password");
    }
  }

  // Enter key support
  document.getElementById("setupPass").addEventListener("keydown", (e)=>{if(e.key==="Enter") setPassword();});
  document.getElementById("loginPass").addEventListener("keydown", (e)=>{if(e.key==="Enter") checkLogin();});

  // Add record
  window.addRecord = async function() {
    const username = document.getElementById("username").value.trim();
    const status = document.getElementById("status").value.trim();
    const elapsed = document.getElementById("elapsed").value.trim();
    const data = document.getElementById("data").value.trim();
    if (!username || !status || !elapsed || !data) return alert("Fill all fields");
    await push(ref(db, "record/"), {
      timestamp: new Date().toISOString(),
      username, status,
      elapsedTime: elapsed,
      data
    });
    alert("Record added!");
  }

  // View records (filtered by selected date)
  window.viewRecords = async function() {
    const snapshot = await get(ref(db, "record"));
    const records = snapshot.val();
    const tableBody = document.getElementById("recordTableBody");
    const selectedDate = document.getElementById("datePicker").value; // yyyy-mm-dd
    tableBody.innerHTML = "";

    if (!records) {
      tableBody.innerHTML = "<tr><td colspan='5'>No records.</td></tr>";
      return;
    }

    const filtered = Object.values(records).filter(r => {
      if (!selectedDate) return true; // if no date selected, show all
      return r.timestamp.startsWith(selectedDate);
    });

    if (filtered.length === 0) {
      tableBody.innerHTML = "<tr><td colspan='5'>No records for selected date.</td></tr>";
      return;
    }

    filtered.forEach((rec) => {
      const statusClass = (rec.status=="1") ? "tick" : "cross";
      tableBody.innerHTML += `
      <tr>
        <td>${rec.timestamp}</td>
        <td>${rec.username}</td>
        <td style="text-align:center;"><div class="status-circle ${statusClass}"></div></td>
        <td>${rec.elapsedTime}</td>
        <td>${rec.data}</td>
      </tr>`;
    });
  }

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebase Record Logger with Password</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, get, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAjBbnm8F76BCb9C5fluUyoZ2QnMSXlHOo",
    authDomain: "test-c7bf3.firebaseapp.com",
    databaseURL: "https://test-c7bf3-default-rtdb.firebaseio.com",
    projectId: "test-c7bf3",
    storageBucket: "test-c7bf3.firebasestorage.app",
    messagingSenderId: "573697013702",
    appId: "1:573697013702:web:fe132fc4d796c06bdbe4c7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  async function checkPassword() {
    const passwordRef = ref(db, "auth/password");
    const snapshot = await get(passwordRef);
    const storedPass = snapshot.val();

    if (!storedPass) {
      const newPass = prompt("Create a new password to secure your database access:");
      if (!newPass || newPass.trim() === "") {
        alert("Password cannot be empty. Reloading page.");
        location.reload();
        return;
      }
      await set(passwordRef, newPass);
      alert("Password saved! Welcome.");
      enableAccess();
    } else {
      const entered = prompt("Enter password:");
      if (entered !== storedPass) {
        alert("Wrong password! Reload to try again.");
      } else {
        enableAccess();
      }
    }
  }

  function enableAccess() {
    document.getElementById("appContent").style.display = "block";
  }

  window.addRecord = async function() {
    const username = document.getElementById("username").value.trim();
    const status = document.getElementById("status").value.trim();
    const elapsed = document.getElementById("elapsed").value.trim();
    const data = document.getElementById("data").value.trim();

    if (!username || !status || !elapsed || !data) {
      alert("Please fill all fields.");
      return;
    }

    const newRecord = {
      timestamp: new Date().toISOString(),
      username: username,
      status: status,
      elapsedTime: elapsed,
      data: data
    };

    await push(ref(db, "record/"), newRecord);
    alert("Record added!");
  };

  window.viewRecords = async function() {
    const snapshot = await get(ref(db, "record"));
    const records = snapshot.val();

    const tableBody = document.getElementById("recordTableBody");
    tableBody.innerHTML = "";

    if (!records) {
      tableBody.innerHTML = "<tr><td colspan='5'>No records found.</td></tr>";
      return;
    }

    Object.values(records).forEach((rec) => {
      const statusClass = (rec.status === "1" || rec.status === 1) ? "tick" : "cross";

      const row = `<tr>
        <td>${rec.timestamp}</td>
        <td>${rec.username}</td>
        <td style="text-align:center;"><div class="status-circle ${statusClass}"></div></td>
        <td>${rec.elapsedTime}</td>
        <td>${rec.data}</td>
      </tr>`;
      tableBody.innerHTML += row;
    });
  };

  // Run password check on load
  window.onload = checkPassword;
</script>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #faf6f0;
    color: #333;
    text-align: center;
    margin: 20px;
  }
  input {
    padding: 6px;
    margin: 5px;
    width: 180px;
  }
  button {
    margin: 8px;
    padding: 8px 16px;
    cursor: pointer;
    border: none;
    background: #3b5998;
    color: white;
    border-radius: 6px;
    transition: background 0.2s;
  }
  button:hover {
    background: #2d4373;
  }
  table {
    border-collapse: collapse;
    margin: 20px auto;
    width: 90%;
    background: white;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
  }
  th {
    background: #e3e3e3;
  }

  .status-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: inline-block;
    position: relative;
    margin: 0 auto;
  }

  .status-circle.tick {
    background-color: #28a745;
  }
  .status-circle.tick::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    width: 6px;
    height: 14px;
    border: solid white;
    border-width: 0 4px 4px 0;
    transform: translate(-50%, -60%) rotate(45deg);
  }

  .status-circle.cross {
    background-color: #dc3545;
  }
  .status-circle.cross::before,
  .status-circle.cross::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    width: 18px;
    height: 4px;
    background-color: white;
  }
  .status-circle.cross::before {
    transform: translate(-50%, -50%) rotate(45deg);
  }
  .status-circle.cross::after {
    transform: translate(-50%, -50%) rotate(-45deg);
  }

  #appContent {
    display: none;
  }
</style>
</head>

<body>

  <h2>Secure Firebase Record Logger</h2>

  <div id="appContent">
    <input type="text" id="username" placeholder="Username">
    <input type="text" id="status" placeholder="Status (1=tick)">
    <input type="text" id="elapsed" placeholder="Elapsed Time">
    <input type="text" id="data" placeholder="Data">
    <br>
    <button onclick="addRecord()">Add Record</button>
    <button onclick="viewRecords()">View Records</button>

    <table id="recordTable">
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>Username</th>
          <th>Status</th>
          <th>Elapsed Time</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody id="recordTableBody">
        <tr><td colspan="5">Click "View Records" to load data.</td></tr>
      </tbody>
    </table>
  </div>

</body>
</html>
